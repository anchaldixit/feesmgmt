<div class="form-control-outer">
    <div class="form-control">
        {% if is_ajax != 'yes' %}
            <div class="form-header">
                <h4>Edit/View</h4>
            </div>
        {% endif %}
        <form action="" method="POST" id="row-edit-form">
            <ul>
                {% for config in field %}
                    <li><label>Module:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="module" id="module"  class="selectbox">
                                    <option value="">Select Module...</option>
                                    {% for keyname, module in modules %}
                                        <option value="{{keyname}}" {{config.module is defined and config.module == keyname ? 'SELECTED': ''}}>{{module}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </li>
                    <li><label>Group:</label>

                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="group_dropdown" class="selectbox" id="group_dd">

                                    <option value="1" {{config.field_group_id is defined and config.field_group_id == 1 ? 'selected':''}}>No Group</option>
                                    {% for group in allgroups %}
                                        {% if group.id != 1 %}
                                            <option  class="{{group.module_name}} hide module" value="{{group.id}}" {{config.field_group_id is defined and group.id == config.field_group_id ? 'selected':''}}>{{group.group_name}}</option>
                                        {% endif %}
                                    {% endfor %}
                                    <option value="">Add New Group</option>
                                </select>
                            </div>

                            <input type="text" name="field_group_name" id="field_group_name" placeholder="New Group Name" style="display:none;margin-top: 15px;"/>
                        </div>
                    </li>
                    <li class="group_display_li" style="display: none;">
                        <label>Group Display Order:</label>

                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="group_display_order" class="selectbox">
                                    <option value="">Select Group Display Order</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                            </div>
                        </div>
                    </li>
                    <li><label>Module Field Name:</label> 
                        <div class="field-wrap">
                            <input name="module_field_display_name" id="module_field_display_name"  value="{{config.module_field_display_name is defined ? config.module_field_display_name : ''}}" type="text" ><br>
                        </div>
                    </li>
                    <li>
                        <label>Module Field Identifier:</label> 
                        <div class="field-wrap">
                            <input name="module_field_name" id="module_field_name"  value = "{{config.module_field_name is defined ? config.module_field_name : ''}}" type="text" readonly> <a href="#" id="fieldname_edit">Click to edit field, default is autogenerated.</a><br>
                        </div>
                    </li>
                    <li>
                        <label>Module Field Type: </label>
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="module_field_datatype" id="module_field_datatype"  class="selectbox">
                                    {% for keyname, datatype in datatypes %} 
                                        <option value="{{keyname}}" {{config.module_field_datatype is defined and config.module_field_datatype == keyname ? 'SELECTED': ''}}>{{datatype}}</option>
                                    {% endfor %}
                                </select><br>
                            </div>
                        </div>
                    </li>
                    <li id="formulafield_row">
                        <label class="m_top">Formula:</label> 
                        <div class="field-wrap">
                            <div class="add_f_field" style="display:none"><a href="#" class="open_formula_popup" data-modal-id="#formulaFields"><i class="fa fa-pencil"></i>Add Formula Field</a></div>
                            <textarea name="formulafield" id="formulafield" placeholder="{{config.formulafield is defined ? config.formulafield : 'module.fieldname * 100'}}"></textarea><br>
                            <small><i>Formula should be inline with mysql</i></small>
                            <small><i>Only use field which are already added to module</i></small>
                            <small><i>Use field module as prefix like customer.customer_name</i></small>
                            <small><i>In case using relational module table. Use relationship module before the field</i></small>
                        </div>
                    </li>
                    <li id="relationship_module_row"> 
                        <label>Relationship Table: </label>
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="relationship_module" id="relationship_module"  class="selectbox" >
                                    <option value="">Select Module..</option>
                                    {% for keyname, module in modules %}
                                        <option value="{{keyname}}" {{config.relationship_module is defined and config.relationship_module == keyname ? 'SELECTED': ''}}>{{module}}</option>
                                    {% endfor %}
                                </select>

                            </div>
                            <small><i>Module Field Identifier should be same as Field Identifier of Relationship Module</i></small>
                        </div>
                    </li>
                    <li id="aggregator_function_row"> 
                        <label>Aggregator Function: </label>
                        <div class="field-wrap">
                            <div class="add_r_field" style="">
                                <a href="#" class="open_aggregator_popup" data-modal-id="#aggregatorFields">
                                    <i class="fa fa-pencil"></i>Add Module Field Identifier
                                </a>
                            </div>
                            <div class="dropdown">
                                <select name="aggregator_function" id="aggregator_function"  class="selectbox" >
                                    <option value="">Select Aggregator..</option>
                                    <option value="count" {{ config.aggregator_function is defined and config.aggregator_function == 'count' ? 'SELECTED': ''}}>Count</option>
                                    <option value="sum" {{config.aggregator_function is defined and config.aggregator_function == 'sum' ? 'SELECTED': ''}}>Sum</option>
                                    <option value="avg" {{config.aggregator_function is defined and config.aggregator_function == 'avg' ? 'SELECTED': ''}}>Avg</option>
                                </select>

                            </div>
                            <small><i>Not sure</i></small>
                        </div>
                    </li>
                    <li id="relationship_module_unique_field_row"> 
                        <label class="m_top">Relationship Module Unique Field: </label>
                        <div class="field-wrap">
                            <div class="add_r_field" style="">
                                <a href="#" class="open_module_field_identifier_popup" data-modal-id="#moduleIdentifierFields">
                                    <i class="fa fa-pencil"></i>Add Relationship Table Identifier
                                </a>&nbsp;&nbsp;&nbsp;
                                <a href="#" class="open_relationship_popup" data-modal-id="#relationalFields">
                                    <i class="fa fa-pencil"></i>Add Relational Field
                                </a>
                            </div>
                            <input name="relationship_module_unique_field" id="relationship_module_unique_field"  value="{{config.relationship_module_unique_field is defined ? config.relationship_module_unique_field : ''}}" type="text" >
                            <br>
                            <small><i>This field of relationship table will be displayed on edit/add form for setting relation. </i></small>
                            <small><i>Field can be combined with pipe separated name like field1|field2 </i></small>
                        </div>
                    </li>
                    <li id="one_2_many_relationship_row"> 
                        <label>One 2 Many Relationship: </label>
                        <div class="field-wrap">
                             <div class="dropdown">
                                <select name="one_2_many_relationship" id="one_2_many_relationship"  class="selectbox" >
                                    <option value="N" {{config.one_2_many_relationship is defined and config.one_2_many_relationship == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.one_2_many_relationship is defined and config.one_2_many_relationship == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>
                            </div>
                        </div>
                    </li>
                    <li><label>Display Position:</label> 
                        <div class="field-wrap">
                            <input name="display_position" id="display_position"  value="{{config.display_position is defined ? config.display_position : '100'}}" type="text" />
                            <br>
                            <small><i>To move column position to left, reduce the value of display position field. </i></small>
                        </div>
                    </li>
                    <li id="varchar_limit_row">
                        <label>Max Character Limit:</label> 
                        <div class="field-wrap">
                            <input name="varchar_limit" id="varchar_limit" value="{{config.varchar_limit is defined ? config.varchar_limit : '64'}}" type="text"><br>
                        </div>
                    </li><li id="value_row">
                        <label>Value Set:</label> 
                        <div class="field-wrap">
                            <textarea name="value" id="value" >{{config.value is defined ? config.value : 'value1|value2|value3'}}</textarea><br>
                        </div>
                    </li>
                    <li id="link_text_row">
                        <label>Link Text:</label> 
                        <div class="field-wrap">
                            <input name="link_text" id="link_text" value="{{config.link_text is defined ? config.link_text : ''}}" type="text"><br>
                        </div>
                    </li>
                    <li id="unique_field_row">
                        <label>Unique Field:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="unique_field" id="unique_field"  class="selectbox" >
                                    <option value="N" {{config.unique_field is defined and config.unique_field == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.unique_field is defined and config.unique_field == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>
                            </div>
                        </div>
                    </li>
                    <li id="enable_filter_row">
                        <label>Enable Filter:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="enable_filter" id="enable_filter"  class="selectbox" >
                                    <option value="N" {{config.enable_filter is defined and config.enable_filter == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.enable_filter is defined and config.enable_filter == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>
                            </div>
                        </div>
                    </li>
                    <li id="enable_filter_with_option_row">
                        <label>Enable Filter With Option:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="enable_filter_with_option" id="enable_filter_with_option"  class="selectbox" >
                                    <option value="N" {{config.enable_filter_with_option is defined and config.enable_filter_with_option == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.enable_filter_with_option is defined and config.enable_filter_with_option == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>

                            </div>
                            <small><i>Enable this option only it is really required, it affects the performance in some means. </i></small>
                        </div>
                    </li>
                    <li> <label>Show in Grid:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="show_in_grid" id="show_in_grid"  class="selectbox">
                                    <option value="Y" {{config.show_in_grid is defined and config.show_in_grid == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                    <option value="N" {{config.show_in_grid is defined and config.show_in_grid == 'N' ? 'SELECTED': ''}}>No</option>

                                </select><br>
                            </div>
                        </div>
                    </li>
                    <li id="required_field_row">
                        <label>Required field:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="required_field" id="required_field"  class="selectbox">
                                    <option value="N" {{config.required_field is defined and config.required_field == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.required_field is defined and config.required_field == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>
                            </div>
                        </div>

                    </li>                        
                    <li id="field_has_relationship_row">
                        <label>Is a foreign key:</label> 
                        <div class="field-wrap">
                            <div class="dropdown">
                                <select name="is_" id="field_has_relationship"  class="selectbox">
                                    <option value="N" {{config.relationship_module is defined and config.relationship_module == 'N' ? 'SELECTED': ''}}>No</option>
                                    <option value="Y" {{config.relationship_module is defined and config.relationship_module == 'Y' ? 'SELECTED': ''}}>Yes</option>
                                </select><br>
                            </div>
                        </div>

                    </li>

                    {% if config.modified_datetime is defined %}
                        <li> 
                            <label>Last Modified:</label> 
                            <div class="field-wrap">
                                <div class="read_text">{{config.modified_datetime is empty ? '' : config.modified_datetime | date("d/m/y g:i a")}}</div><br>
                            </div>
                        </li>
                        <li>
                            <label>Modified by:</label> 
                            <div class="field-wrap">
                                <div class="read_text">{{config.modified_by}}</div>
                            </div>
                        </li>
                    {% endif %}

                    <li class="action-button-row">
                        <label>&nbsp;</label> 
                        <div class="field-wrap">
                            {% if id is defined and id is not empty %}
                                <input type="hidden" name="id" id="edit_id_hidden_field" value="{{id}}">
                                <input type="hidden" name="module_field_datatype" value="{{config.module_field_datatype}}">
                                <input type="submit" name="edit_submit" value="Save" > 
                                <input type="submit" name="delete_submit" value="Delete" id="delete_action" onsubmit="return confirm('Are you sure to delete the column with data, this step cannot be rollbacked')">
                            {% else %}
                                <input type="submit" name="add_submit" value="Add" > 

                            {% endif %}
                        </div>
                    </li>

                {% endfor %}

            </ul>
        </form>
    </div>
</div>

<div class="popup-wrapper" id="formulaFields" style="display:none;">
    <div class="popup" style="width:650px;">
        <div class="create-roles-outer">
            <div class="popup-header">
                <h4>Formula Fields</h4>
                <a class="close-popup" href="#"><i class="fa fa-times red"></i></a>
            </div>
            <div class="popup-body">
                <div class="create-roles" style="max-height:400px; margin-bottom: 10px; overflow: auto;">
                    <table id="formula_popup" class="popup_table">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Field Name</th>

                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>

                </div>
                <input type="submit" name="formula_field_btn" class="formula_field_btn" value="Add" />
                <input type="button" name="cancel" class="close-popup cancel-popup" value="Cancel">
                <div class="msg" style="display: none; clear: both"><p></p></div>
            </div>
        </div>
    </div>
</div>

<div class="popup-wrapper" id="relationalFields" style="display:none;">
    <div class="popup" style="width:650px;">
        <div class="create-roles-outer">
            <div class="popup-header">
                <h4>Relational Module Fields</h4>
                <a class="close-popup" href="#"><i class="fa fa-times red"></i></a>
            </div>
            <div class="popup-body">
                <div class="create-roles" style="max-height:400px; margin-bottom: 10px; overflow: auto;">
                    <table id="relation_popup" class="popup_table">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Field Name</th>

                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>

                </div>
                <input type="submit" name="relation_field_btn" class="relation_field_btn" value="Add" />
                <input type="button" name="cancel" class="close-popup cancel-popup" value="Cancel">
                <div class="msg" style="display: none; clear: both"><p></p></div>
            </div>
        </div>
    </div>
</div>

<div class="popup-wrapper" id="moduleIdentifierFields" style="display:none;">
    <div class="popup" style="width:350px;">
        <div class="create-roles-outer">
            <div class="popup-header">
                <h4>Module Field Identifier</h4>
                <a class="close-popup" href="#"><i class="fa fa-times red"></i></a>
            </div>
            <div class="popup-body">
                <div class="create-roles" style="max-height:400px; margin-bottom: 10px; overflow: auto;">
                    <select id="module_field_identifiers" style="width:100%">

                    </select>    

                </div>
                <input type="button" name="cancel" class="close-popup cancel-popup" value="Close">
                <div class="msg" id="re_response" style="display: none; clear: both"><p></p></div>
            </div>
        </div>
    </div>
</div>

<div class="popup-wrapper" id="aggregatorFields" style="display:none;">
    <div class="popup" style="width:350px;">
        <div class="create-roles-outer">
            <div class="popup-header">
                <h4>Aggregator Module Field Identifier</h4>
                <a class="close-popup" href="#"><i class="fa fa-times red"></i></a>
            </div>
            <div class="popup-body">
                <div class="create-roles" style="max-height:400px; margin-bottom: 10px; overflow: auto;">
                    <select id="aggregator_field_identifiers" style="width:100%">

                    </select>    

                </div>
                <input type="button" name="cancel" class="close-popup cancel-popup" value="Close">
                <div class="msg" id="ag_response" style="display: none; clear: both"><p></p></div>
            </div>
        </div>
    </div>
</div>