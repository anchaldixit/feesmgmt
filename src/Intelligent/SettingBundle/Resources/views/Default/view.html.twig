{# Intelligent/SettingBundle/Resources/views/Default/view.html.twig #}
{% extends "base.html.twig"  %}
{% block stylesheets %}
    {{ parent() }}
    <link href="/assets/js/jquery-ui/jquery-ui.min.css" rel="stylesheet" type="text/css"/>

    <style>
        .full-container{
            width: 100%;
        }
        .left-container{
            width: 20%;
            float: left;
        }
        .right-container{
            width: 80%;
            float: left;
        }
        .right-container table{
            width: 100% !important;
        }

        .selected_fitlers_container{
            width: 100%;
        }
        .selected_filter{
            float: left;
            padding: 5px 15px;
            margin: 5px 15px;
        }

        .form-control-outer .form-control{
            width:100%;
            margin:0 auto;
            overflow: auto;
            height: 500px;
        }
        #dialog{
            padding: 0;
        }
        .form-control-outer .form-control ul li .field-wrap .dropdown{
            width: 300px;
        }
        .form-control-outer .form-control ul li .field-wrap .dropdown .selectbox{
            width:90%;
        }
        .action-button-row{
            position: absolute;
            bottom: 0;
            right: 0;
            cursor: pointer;
            width: 100%;
            padding:10px 0;
            background-color: lightblue;
            background-color: rgba(173,216,230, 0.6);
        }



    </style>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="/assets/js/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/assets/js/quickedit-settings.js" type="text/javascript"></script>

    <script>


        jQuery(document).ready(function ($) {

            $("#filter_form input[type='radio'],#filter_form select").change(function () {
                $("#filter_form").submit();
            });
            $('.selected_fitlers_container .selected_filter span').on('click', function () {

                var filter = $(this).attr('data-resetfilter');
                if (filter == 'module_field_display_name') {
                    $("#filter_form input[name='filter[text][" + filter + "]'").val('')
                } else {
                    $("#filter_form input[name='filter[match][" + filter + "]'").prop('checked', false);

                }
                $(this).parent().remove();
                $("#filter_form").submit();

            });

            if ($('.setting_table').length) {
                var table = $('table.setting_table');
                //console.log(jQuery.floatThead());
                table.floatThead({
                    position: 'absolute',
                    scrollContainer: function (table) {
                        return table.closest('.table-outer');
                    }
                });
            }

            var q_edit_obj = new QuickEdit();
            q_edit_obj.init();

            if ($('.search_list').length) {
                $('.search_list').keyup(function () {
                    var valThis = this.value.toLowerCase();
                    lenght = this.value.length;
                    var ulId = $(this).next('ul').attr('id');
                    $('#' + ulId + '> li').each(function () {
                        var text = $(this).find('label').text();
                        textL = text.toLowerCase();
                        console.log(textL.indexOf(valThis));
                        (textL.indexOf(valThis) >= 0) ? $(this).show() : $(this).hide();
                    });

                });
            }

        });




    </script>
{% endblock %}
{% block body %}
    <div id="dialog" title="Quick Edit" style="display:none"></div>
    <div class="bottom-sec">
        <div class="bread-crumb">
            <span id="module_name">Module Settings</span>
            <i class="fa fa-long-arrow-right"></i>
            <span>View</span>
        </div>
        <div class="custom-feature">
            <a class="red-btn" id="quick_add_row"><i class="fa fa-plus"></i> Quick Add</a> <a class="red-btn" href="{{ path('intelligent_setting_edit',  app.request.query.all| merge( {'edit_id': 'new'})) }}"><i class="fa fa-plus"></i>Add</a>
        </div>
    </div>
    <div class="full-container content-table">
        <div class="left-container left-sidebar">
            <form method='GET' id="filter_form">
                <div class="filter-box">
                    <h6><a href="#"><i class="fa fa-caret-down"></i>Sort</a></h6>
                    <ul>
                        <li>
                            <select name="sort">
                                <option value="">Sort By</option>
                                <option value="module|asc"  {{selected_filters.sort is defined and selected_filters.sort == 'module|asc'? 'SELECTED':'' }}>Module(asc)</option>
                                <option value="module|desc" {{selected_filters.sort is defined and selected_filters.sort == 'module|desc'? 'SELECTED':'' }}>Module(desc)</option>
                                <option value="module_field_display_name|asc" {{selected_filters.sort is defined and selected_filters.sort == 'module_field_display_name|asc'? 'SELECTED':'' }}>Field Name(asc)</option>
                                <option value="module_field_display_name|desc" {{selected_filters.sort is defined and selected_filters.sort == 'module_field_display_name|desc'? 'SELECTED':'' }}>Field Name(desc)</option>
                                <option value="module_field_datatype|asc" {{selected_filters.sort is defined and selected_filters.sort == 'module_field_datatype|asc'? 'SELECTED':'' }}>Datatype(asc)</option>
                                <option value="module_field_datatype|desc" {{selected_filters.sort is defined and selected_filters.sort == 'module_field_datatype|desc'? 'SELECTED':'' }}>Datatype(desc)</option>

                            </select>
                        </li>
                    </ul>
                </div>
                <div class="filter-box">
                    <h6><a href="#"><i class="fa fa-caret-down"></i>Field Name</a></h6>
                    <ul>
                        <li>
                            <input name="filter[text][module_field_display_name]" type="text" placeholder="Text search" value="{{selected_filters.filter.text.module_field_display_name is defined and selected_filters.filter.text.module_field_display_name is not empty ? selected_filters.filter.text.module_field_display_name | trim:'' }}">
                            <input type='submit' value=">>">
                        </li>
                    </ul>
                </div>
                <div class="filter-box">
                    <h6><a href="#"><i class="fa fa-caret-down"></i>Modules</a></h6>
                    <div class="filter_wrap">
                        <input type="text" placeholder="Search by Modules" class="search_list" />
                        <ul id="modules_list">
                            {% for keyname, module in modules %}
                                <li><input type="radio" name="filter[match][module]" id="{{keyname}}"  value="{{keyname}}"
                                           {{selected_filters.filter.match.module is defined and selected_filters.filter.match.module == keyname? 'CHECKED':'' }}><label for="{{keyname}}">{{module}}</label> </li>
                                    {% endfor %}

                        </ul>
                    </div>
                </div>
                <div class="filter-box">
                    <h6><a href="#"><i class="fa fa-caret-down"></i>Datatype</a></h6>
                    <div class="filter_wrap">
                        <input type="text" placeholder="Search by Datatype" class="search_list" />
                        <ul id="datatype_list">
                            {% for keyname, datatype in datatypes %}
                                <li><input type="radio" name="filter[match][module_field_datatype]" id="{{keyname}}" value="{{keyname}}"
                                           {{selected_filters.filter.match.module_field_datatype is defined and selected_filters.filter.match.module_field_datatype == keyname? 'CHECKED':'' }}> <label for="{{keyname}}">{{datatype}}</label></li>
                                {% endfor %}
                        </ul>
                    </div>
                </div>
            </form>

        </div>
        <div class="right-container table-content">
            <div class="selected_fitlers_container">

                {% if selected_filters.filter.text.module_field_display_name is defined and  selected_filters.filter.text.module_field_display_name is not empty%}
                    <div class="selected_filter">
                        <small>Field name like {{selected_filters.filter.text.module_field_display_name}}</small> <span data-resetfilter="module_field_display_name">X</span> 
                    </div>
                {% endif %}
                {% if selected_filters.filter.match.module is defined%}
                    <div class="selected_filter" >
                        <small><b>Module:</b> {{modules[selected_filters.filter.match.module]}} </small> <span data-resetfilter="module">X</span> 
                    </div>
                {% endif %}
                {% if selected_filters.filter.match.module_field_datatype is defined%}
                    <div class="selected_filter" >
                        <small><b> DataType:</b> {{datatypes[selected_filters.filter.match.module_field_datatype]}} </small> <span data-resetfilter="module_field_datatype">X</span> 
                    </div>
                {% endif %}
                {% if selected_filters.sort is defined and  selected_filters.sort is not empty%}
                    <!--<div class="selected_filter">
                        Sort By {{selected_filters.filter.text.module_field_display_name}} <span data-resetfilter="module_field_display_name">X</span> 
                    </div>-->
                {% endif %}
            </div>

            {% if pagination.total_record > 0 %}
                <div id="display-count">
                    <p>
                        Displaying 
                        <span class="lower-limit"> {{((pagination.active - 1)*pagination.limit) + 1 }} </span>
                        to 
                        <span class="upper-limit"> {{((pagination.active * pagination.limit) > pagination.total_record) ? pagination.total_record : pagination.active * pagination.limit}} </span>
                        out of 
                        <span class="total-result">{{pagination.total_record}}</span> 
                        Fields
                    </p>
                </div>
            {% endif %}

            <table class="setting_table">
                <thead>
                    <tr>
                        <th>Module</th>
                        <th>Field</th>
                        <th>Data Type</th>
                        <th>Display Position</th>
                        <th>Filtered Enable</th>
                        <th>Last Modified</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    {{ include('IntelligentSettingBundle:Default:view-row.html.twig', with_context = true) }}
                </tbody>

            </table>

            {{ include('IntelligentSettingBundle:Default:pagination.html.twig', { 'pagination': pagination }) }}
        </div>

    </div>
    <span class="notify"><i class="fa fa-info-circle"></i><span class="info-notice"></span> </span>

{% endblock %}